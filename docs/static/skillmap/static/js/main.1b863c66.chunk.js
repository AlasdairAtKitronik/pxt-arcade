(window.webpackJsonpskillsmap=window.webpackJsonpskillsmap||[]).push([[0],{24:function(e,t,a){e.exports=a(45)},38:function(e,t,a){},39:function(e,t,a){},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){"use strict";a.r(t);var r,n,i=a(0),c=a.n(i),s=a(18),o=a.n(s),l=a(8),d=a(13),u=a(11),p=a(1),m=a(2),v=a.n(m),h=a(7),f="https://www.makecode.com/api/md";function b(e){var t={cmd:"",arg:""},a=/^(\w+)(:([:./\-+=\w]+))?/.exec((e||window.location.hash).replace(/^#/,""));return a&&(t={cmd:a[1],arg:a[3]||""}),t}function y(){var e={},t=window.location.search;t&&new URLSearchParams(t).forEach((function(t,a){"true"!==t.toLowerCase()&&"1"!==t||(t="true"),e[a]=t}));return e}function g(e,t){return k.apply(this,arguments)}function k(){return(k=Object(h.a)(v.a.mark((function e(t,a){var r,n,i,c,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&a){e.next=2;break}return e.abrupt("return",void 0);case 2:i="unknown",e.t0=t,e.next="docs"===e.t0?6:"github"===e.t0?11:14;break;case 6:return a=a.trim().replace(/^[\\/]/i,"").replace(/\.md$/i,""),c=(null===(r=window.pxtTargetBundle)||void 0===r?void 0:r.name)||"arcade",n="".concat(f,"/").concat(c,"/").concat(a),i="approved",e.abrupt("break",16);case 11:return e.next=13,E(a);case 13:return e.abrupt("return",e.sent);case 14:return n=a,e.abrupt("break",16);case 16:return e.next=18,S(n);case 18:return s=e.sent,e.abrupt("return",{text:s,identifier:n,status:i});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return O.apply(this,arguments)}function O(){return(O=Object(h.a)(v.a.mark((function e(t){var a,r,n,i,c,s,o,l;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=pxt.github.parseRepoId(t),e.next=3,pxt.packagesConfigAsync();case 3:r=e.sent,n=pxt.github.repoStatus(a,r),i="unknown",e.t0=n,e.next=e.t0===pxt.github.GitRepoStatus.Banned?9:e.t0===pxt.github.GitRepoStatus.Approved?12:15;break;case 9:return i="banned",c="https://github.com/"+a.fullName,e.abrupt("break",17);case 12:return i="approved",c=void 0,e.abrupt("break",17);case 15:return c="https://github.com/"+a.fullName,e.abrupt("break",17);case 17:if(e.t1=a.tag,e.t1){e.next=22;break}return e.next=21,pxt.github.latestVersionAsync(a.fullName,r,!0);case 21:e.t1=e.sent;case 22:if(s=e.t1){e.next=26;break}return pxt.log("skillmap github tag not found at ".concat(a.fullName)),e.abrupt("return",void 0);case 26:return a.tag=s,e.next=29,pxt.github.downloadPackageAsync("".concat(a.fullName,"#").concat(a.tag),r);case 29:if(!(o=e.sent)){e.next=36;break}return l=(l=(l=(l=a.fileName||"skillmap").replace(/^\/?blob\/main\//,"")).replace(/^\/?blob\/master\//,"")).replace(/\.md$/,""),e.abrupt("return",{text:pxt.tutorial.resolveLocalizedMarkdown(a,o.files,l),identifier:a.fullName+"#"+l,reportId:c,status:i});case 36:return e.abrupt("return",void 0);case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return(I=Object(h.a)(v.a.mark((function e(t,a){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,C("/api/".concat(encodeURIComponent(t),"/abusereports"),a);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return new Promise((function(t,a){var r=new XMLHttpRequest;r.addEventListener("error",(function(e){a(e)})),r.addEventListener("load",(function(){try{t(r.responseText)}catch(e){a(e)}})),r.open("GET",e),r.send()}))}function C(e,t){return new Promise((function(a,r){var n=new XMLHttpRequest;n.addEventListener("error",(function(e){r(e)})),n.addEventListener("load",(function(){try{a(n.responseText)}catch(e){r(e)}})),n.open("POST",e,!0),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(t))}))}function w(){var e=new Uint8Array(4);return function(e){if(window.crypto)window.crypto.getRandomValues(e);else for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())}(e),new Uint32Array(e.buffer)[0]}function j(){function e(){return(65536|w()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()}function A(){return"localhost"===window.location.hostname}function x(e){return"".concat(A()?"":"/static/skillmap","/").concat(e.replace(/^\//,""))}function T(e){n=e}function N(e,t){var a,i;(t=t||{}).page=n,t.pageTitle=r,null===(a=(i=window).pxtTickEvent)||void 0===a||a.call(i,e,t)}var R=a(9);function U(e,t,a){return!Object.keys(null===t||void 0===t?void 0:t.activities).some((function(r){var n,i;return!(null===e||void 0===e||null===(n=e.mapProgress[t.mapId])||void 0===n||null===(i=n.activityState[r])||void 0===i?void 0:i.isCompleted)&&r!==a}))}function L(e,t,a){var r;return!!(null===(r=P(e,t,a))||void 0===r?void 0:r.isCompleted)}function M(e,t,a){var r,n=Object(R.a)(t.prerequisites);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("tag"===i.type){if(!e.completedTags[a])return!1;var c=e.completedTags[a][i.tag];if(void 0===c||c<i.numberCompleted)return!1}else if("map"===i.type&&!U(e,t))return!1}}catch(s){n.e(s)}finally{n.f()}return!0}function _(e,t){var a,r={},n=Object(R.a)(t);try{for(n.s();!(a=n.n()).done;)for(var i=a.value,c=0,s=Object.keys(i.activities);c<s.length;c++){var o=s[c],l=i.activities[o];if(L(e,i.mapId,l.activityId)){var d,u=Object(R.a)(l.tags);try{for(u.s();!(d=u.n()).done;){var p=d.value;r[p]||(r[p]=0),r[p]++}}catch(m){u.e(m)}finally{u.f()}}}}catch(m){n.e(m)}finally{n.f()}return r}function P(e,t,a){var r;return null===(r=e.mapProgress[t])||void 0===r?void 0:r.activityState[a]}var D={title:lf("Game Maker Guide"),description:lf("Level up your game making skills by completing the tutorials in this guide."),pageSourceStatus:"unknown",user:{isDebug:!0,id:j(),mapProgress:{},completedTags:{}},maps:{}};function V(e,t,a,r,n,i){var c,s,o,l=t.mapId,d=P(e,l,a);d||(d={isCompleted:!1,activityId:a,currentStep:n,maxSteps:i,headerId:r});var m=U(e,t,a)&&!d.isCompleted,v=d.isCompleted||void 0!==n&&void 0!==i&&n>=i;return Object(p.a)(Object(p.a)({},e),{},{mapProgress:Object(p.a)(Object(p.a)({},e.mapProgress),{},Object(u.a)({},l,Object(p.a)(Object(p.a)({},e.mapProgress[l]||{mapId:l}),{},{activityState:Object(p.a)(Object(p.a)({},(null===(c=e.mapProgress[l])||void 0===c?void 0:c.activityState)||{}),{},Object(u.a)({},a,Object(p.a)(Object(p.a)({},d),{},{headerId:r,currentStep:n,maxSteps:i,isCompleted:v}))),completionState:m?"transitioning":null===(s=e.mapProgress)||void 0===s||null===(o=s[l])||void 0===o?void 0:o.completionState})))})}function H(e,t,a){var r,n,i,c=t.mapId,s=P(e,c,a);s||(s={isCompleted:!1,activityId:a,headerId:"",currentStep:0});var o=U(e,t,a)&&!s.isCompleted;return Object(p.a)(Object(p.a)({},e),{},{mapProgress:Object(p.a)(Object(p.a)({},e.mapProgress),{},Object(u.a)({},c,Object(p.a)(Object(p.a)({},e.mapProgress[c]||{mapId:c}),{},{activityState:Object(p.a)(Object(p.a)({},(null===(r=e.mapProgress[c])||void 0===r?void 0:r.activityState)||{}),{},Object(u.a)({},a,Object(p.a)(Object(p.a)({},s),{},{isCompleted:!0}))),completionState:o?"transitioning":null===(n=e.mapProgress)||void 0===n||null===(i=n[c])||void 0===i?void 0:i.completionState})))})}var W,B,q=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"ADD_SKILL_MAP":return Object(p.a)(Object(p.a)({},t),{},{user:Object(p.a)(Object(p.a)({},t.user),{},{mapProgress:Object(p.a)(Object(p.a)({},t.user.mapProgress),{},Object(u.a)({},a.map.mapId,{completionState:"incomplete",mapId:a.map.mapId,activityState:{}}))}),maps:Object(p.a)(Object(p.a)({},t.maps),{},Object(u.a)({},a.map.mapId,a.map))});case"CLEAR_SKILL_MAPS":return Object(p.a)(Object(p.a)({},t),{},{maps:{}});case"CHANGE_SELECTED_ITEM":return Object(p.a)(Object(p.a)({},t),{},{selectedItem:a.id});case"SET_SKILL_MAP_COMPLETED":return Object(p.a)(Object(p.a)({},t),{},{user:Object(p.a)(Object(p.a)({},t.user),{},{mapProgress:Object(p.a)(Object(p.a)({},t.user.mapProgress),{},Object(u.a)({},a.mapId,Object(p.a)(Object(p.a)({},t.user.mapProgress[a.mapId]),{},{completionState:"completed"})))})});case"OPEN_ACTIVITY":return Object(p.a)(Object(p.a)({},t),{},{editorView:{currentMapId:a.mapId,currentActivityId:a.activityId,state:"active",currentHeaderId:null===(e=P(t.user,a.mapId,a.activityId))||void 0===e?void 0:e.headerId}});case"SAVE_AND_CLOSE_ACTIVITY":return Object(p.a)(Object(p.a)({},t),{},{editorView:Object(p.a)(Object(p.a)({},t.editorView),{},{state:"saving"})});case"CLOSE_ACTIVITY":return Object(p.a)(Object(p.a)({},t),{},{editorView:void 0,user:a.finished?H(t.user,t.maps[t.editorView.currentMapId],t.editorView.currentActivityId):t.user});case"RESTART_ACTIVITY":return Object(p.a)(Object(p.a)({},t),{},{modal:void 0,editorView:{state:"active",currentMapId:a.mapId,currentActivityId:a.activityId},user:V(t.user,t.maps[a.mapId],a.activityId)});case"SET_HEADERID_FOR_ACTIVITY":return t.editorView?Object(p.a)(Object(p.a)({},t),{},{editorView:Object(p.a)(Object(p.a)({},t.editorView),{},{currentHeaderId:a.id}),user:V(t.user,t.maps[t.editorView.currentMapId],t.editorView.currentActivityId,a.id,a.currentStep,a.maxSteps)}):t;case"SET_USER":return Object(p.a)(Object(p.a)({},t),{},{user:a.user});case"RESET_USER":return Object(p.a)(Object(p.a)({},t),{},{user:Object(p.a)(Object(p.a)({},t.user),{},{completedTags:{},mapProgress:{}})});case"UPDATE_USER_COMPLETED_TAGS":return t.pageSourceUrl?Object(p.a)(Object(p.a)({},t),{},{user:Object(p.a)(Object(p.a)({},t.user),{},{completedTags:Object(p.a)(Object(p.a)({},t.user.completedTags),{},Object(u.a)({},t.pageSourceUrl,_(t.user,Object.keys(t.maps).map((function(e){return t.maps[e]})))))})}):t;case"SET_PAGE_TITLE":return Object(p.a)(Object(p.a)({},t),{},{title:a.title});case"SET_PAGE_DESCRIPTION":return Object(p.a)(Object(p.a)({},t),{},{description:a.description});case"SET_PAGE_INFO_URL":return Object(p.a)(Object(p.a)({},t),{},{infoUrl:a.infoUrl});case"SET_PAGE_SOURCE_URL":return Object(p.a)(Object(p.a)({},t),{},{pageSourceUrl:a.url,pageSourceStatus:a.status});case"SHOW_COMPLETION_MODAL":return Object(p.a)(Object(p.a)({},t),{},{modal:{type:"completion",currentMapId:a.mapId,currentActivityId:a.activityId}});case"SHOW_RESTART_ACTIVITY_MODAL":return Object(p.a)(Object(p.a)({},t),{},{modal:{type:"restart-warning",currentMapId:a.mapId,currentActivityId:a.activityId}});case"SHOW_REPORT_ABUSE_MODAL":return Object(p.a)(Object(p.a)({},t),{},{modal:{type:"report-abuse",currentMapId:a.mapId,currentActivityId:a.activityId}});case"SHOW_RESET_USER_MODAL":return Object(p.a)(Object(p.a)({},t),{},{modal:{type:"reset"}});case"HIDE_MODAL":return Object(p.a)(Object(p.a)({},t),{},{modal:void 0});default:return t}},G=Object(d.b)(q),F=a(3),Y=a(4),K=a(6),z=a(5),Q=a(23),J=function(e,t){return{type:"OPEN_ACTIVITY",mapId:e,activityId:t}},$=function(){return{type:"SAVE_AND_CLOSE_ACTIVITY"}},X=function(){return{type:"HIDE_MODAL"}},Z=(a(38),function(e){Object(K.a)(a,e);var t=Object(z.a)(a);function a(e){var r;return Object(F.a)(this,a),(r=t.call(this,e)).handleOnClick=function(){r.setState({expanded:!r.state.expanded})},r.handleOnBlur=function(){r.setState({expanded:!1})},r.state={expanded:!1},r}return Object(Y.a)(a,[{key:"getItemOnClick",value:function(e){return function(){return e.onClick(e.id)}}},{key:"render",value:function(){var e=this,t=this.props,a=t.icon,r=t.items,n=t.className,c=this.state.expanded;return i.createElement("div",{className:"dropdown ".concat(n," ").concat(c?"expanded":""),tabIndex:0,role:"button",onClick:this.handleOnClick,onBlur:this.handleOnBlur},i.createElement("i",{className:"icon ".concat(a)}),c&&i.createElement("div",{className:"dropdown-menu"},r.map((function(t,a){return i.createElement("div",{key:a,className:"dropdown-item",onClick:e.getItemOnClick(t),role:"menuitem"},t.label)}))))}}]),a}(i.Component));function ee(){return B||(W=new pxt.skillmap.IndexedDBWorkspace,B=W.initAsync().then((function(e){return W}))),B}function te(e){return ae.apply(this,arguments)}function ae(){return(ae=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee();case 2:return a=e.sent,e.abrupt("return",a.getProjectAsync(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e){return ne.apply(this,arguments)}function ne(){return(ne=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee();case 2:return a=e.sent,e.next=5,a.saveProjectAsync(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(){return ce.apply(this,arguments)}function ce(){return(ce=Object(h.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee();case 2:return t=e.sent,e.abrupt("return",t.getUserStateAsync());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e){return oe.apply(this,arguments)}function oe(){return(oe=Object(h.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isDebug){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,ee();case 4:return a=e.sent,e.next=7,a.saveUserStateAsync(t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(39);var le=A()?"http://localhost:3232/index.html":window.pxtTargetBundle.appTheme.embedUrl,de=function(e){Object(K.a)(a,e);var t=Object(z.a)(a);function a(e){var r;return Object(F.a)(this,a),(r=t.call(this,e)).ref=void 0,r.messageQueue=[],r.finishedActivityState=void 0,r.nextId=0,r.pendingMessages={},r.handleFrameRef=function(e){if(e&&e.contentWindow){window.addEventListener("message",r.onMessageReceived),r.ref=e,r.ref.addEventListener("load",(function(){r.state.unloading&&(r.props.dispatchCloseActivity("finished"===r.finishedActivityState),r.props.dispatchUpdateUserCompletedTags(),r.finishedActivityState=void 0)})),ue(".usabilla_live_button_container",!1),ue("footer",!1);var t=document.getElementById("root");t&&pxt.BrowserUtils.addClass(t,"editor")}},r.onMessageReceived=function(e){var t=e.data;if("ready"!==t.type){if("pxteditor"===t.type&&t.id&&r.pendingMessages[t.id])return r.onResponseReceived(r.pendingMessages[t.id],e.data),void delete r.pendingMessages[t.id];switch(t.action){case"event":r.handleEditorTickEvent(t);break;case"workspacesync":r.handleWorkspaceSyncRequest(t);break;case"workspacesave":r.handleWorkspaceSaveRequestAsync(t)}}else r.handleWorkspaceReadyEventAsync()},r.state={loaded:!1,unloading:!1},r}return Object(Y.a)(a,[{key:"componentDidUpdate",value:function(){this.props.save&&this.sendMessage({type:"pxteditor",action:"saveproject",response:!1},!0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.onMessageReceived),ue(".usabilla_live_button_container",!0),ue("footer",!0);var e=document.getElementById("root");e&&pxt.BrowserUtils.removeClass(e,"editor")}},{key:"render",value:function(){var e=this.props,t=e.url,a=e.title,r=e.save,n=this.state,c=n.loaded,s=n.unloading,o=r?lf("Saving..."):lf("Loading...");return i.createElement("div",{className:"makecode-frame-outer"},i.createElement("div",{className:"makecode-frame-loader ".concat(c&&!r?"hidden":"")},i.createElement("img",{src:x("assets/logo.svg"),alt:"MakeCode Logo"}),i.createElement("div",{className:"makecode-frame-loader-text"},o)),i.createElement("iframe",{className:"makecode-frame",src:s?"about:blank":t,title:a,ref:this.handleFrameRef}))}},{key:"onResponseReceived",value:function(e,t){var a=this.props.save;"saveproject"===e.action&&a&&("saving"===this.finishedActivityState?(this.finishedActivityState="finished",this.sendMessage({type:"pxteditor",action:"saveproject"},!0)):this.setState({unloading:!0})),"importproject"===e.action&&this.onEditorLoaded()}},{key:"sendMessage",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=function(e){a&&(e.response=!0,e.id=t.nextId+++"",t.pendingMessages[e.id]=e),t.ref.contentWindow.postMessage(e,"*")};if(this.ref)if(this.ref.contentWindow){for(;this.messageQueue.length;)r(this.messageQueue.shift());r(e)}else this.messageQueue.push(e)}},{key:"handleWorkspaceSyncRequest",value:function(e){this.sendMessage(Object(p.a)(Object(p.a)({},e),{},{success:!0,projects:[]}))}},{key:"handleWorkspaceSaveRequestAsync",value:function(){var e=Object(h.a)(v.a.mark((function e(t){var a,r,n,i,c,s,o,l,d,u,m;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,n=r.dispatchSetHeaderIdForActivity,i=r.activityHeaderId,c=r.activityType,s=r.title,o=Object(p.a)(Object(p.a)({},t.project),{},{header:Object(p.a)(Object(p.a)({},t.project.header),{},{id:i||t.project.header.id})}),(null===(a=o.header)||void 0===a?void 0:a.name)!==s&&(o.header.name=s,(l=o.text["pxt.json"])&&((d=JSON.parse(l)).name=s,o.text["pxt.json"]=pxt.Package.stringifyConfig(d))),!o.header.tutorialCompleted){e.next=8;break}return e.next=6,te(o.header.id);case 6:(null===(m=e.sent)||void 0===m||null===(u=m.header)||void 0===u?void 0:u.tutorial)&&(o.header.tutorial=m.header.tutorial,o.header.tutorial.tutorialStep=o.header.tutorialCompleted.steps-1,delete o.header.tutorialCompleted);case 8:if("tutorial"===c&&!o.header.tutorial&&!o.header.tutorialCompleted){e.next=11;break}return e.next=11,re(o);case 11:o.header.tutorial?n(o.header.id,(o.header.tutorial.tutorialStep||0)+1,o.header.tutorial.tutorialStepInfo.length):o.header.tutorialCompleted&&n(o.header.id,o.header.tutorialCompleted.steps,o.header.tutorialCompleted.steps);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleWorkspaceReadyEventAsync",value:function(){var e=Object(h.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.activityHeaderId){e.next=7;break}return e.next=3,te(this.props.activityHeaderId);case 3:t=e.sent,this.sendMessage({type:"pxteditor",action:"importproject",project:t},!0),e.next=8;break;case 7:this.sendMessage({type:"pxteditor",action:"startactivity",path:this.props.tutorialPath,activityType:"tutorial"},!0);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleEditorTickEvent",value:function(e){switch(e.tick){case"tutorial.editorLoaded":this.onEditorLoaded();break;case"tutorial.complete":this.onTutorialFinished()}}},{key:"onEditorLoaded",value:function(){var e=this.props;N("skillmap.activity.loaded",{path:e.mapId,activity:e.activityId}),this.setState({loaded:!0})}},{key:"onTutorialFinished",value:function(){var e=this.props;N("skillmap.activity.complete",{path:e.mapId,activity:e.activityId}),this.finishedActivityState="saving",this.props.dispatchSaveAndCloseActivity()}}]),a}(i.Component);function ue(e,t){var a=document.querySelector(e);(null===a||void 0===a?void 0:a.style)&&(a.style.display=t?"":"none")}var pe={dispatchSetHeaderIdForActivity:function(e,t,a){return{type:"SET_HEADERID_FOR_ACTIVITY",id:e,currentStep:t,maxSteps:a}},dispatchCloseActivity:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{type:"CLOSE_ACTIVITY",finished:e}},dispatchSaveAndCloseActivity:$,dispatchUpdateUserCompletedTags:function(){return{type:"UPDATE_USER_COMPLETED_TAGS"}}},me=Object(l.b)((function(e,t){var a;if(!e||!e.editorView)return{};var r,n=e.editorView,i=n.currentActivityId,c=n.currentMapId,s=n.currentHeaderId,o=n.state,l=le,d=e.maps[c].activities[i];return"/"!==le.charAt(le.length-1)||A()||(l=le.substr(0,le.length-1)),l+="?controller=1&skillsMap=1&noproject=1&nocookiebanner=1",r=d.displayName,{url:l,tutorialPath:d.url,title:r,mapId:c,activityId:i,activityHeaderId:s,completed:null===(a=P(e.user,c,i))||void 0===a?void 0:a.isCompleted,activityType:d.type,save:"saving"===o}}),pe)(de),ve=function(e){Object(K.a)(a,e);var t=Object(z.a)(a);function a(){var e;Object(F.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).reportAbuseUrl="https://github.com/contact/report-content",e.onBackClicked=function(){var t=e.props;N("skillmap.activity.back",{path:t.currentMapId||"",activity:t.currentActivityId||""}),e.props.dispatchSaveAndCloseActivity()},e.onSaveClicked=function(){var t=e.props,a=t.completedHeaderId;N("skillmap.export",{path:t.currentMapId||"",activity:t.currentActivityId||""}),window.open("".concat(le,"#skillmapimport:").concat(a))},e}return Object(Y.a)(a,[{key:"getSettingItems",value:function(){var e=this,t=[];return this.props.showReportAbuse&&t.push({id:"report",label:lf("Report Abuse"),onClick:function(t){N("skillmap.reportabuse"),window.open(e.reportAbuseUrl)}}),t.push({id:"reset",label:lf("Reset All"),onClick:function(){N("skillmap.reset.warning"),e.props.dispatchShowResetUserModal()}}),t}},{key:"render",value:function(){var e=this.props,t=e.activityOpen,a=e.completedHeaderId,r=this.getSettingItems();return i.createElement("div",{className:"header"},i.createElement("div",{className:"header-left"},t?i.createElement("i",{className:"icon arrow left",role:"button",onClick:this.onBackClicked}):i.createElement("div",{className:"header-logo"},i.createElement("img",{src:x("assets/logo.svg"),alt:"MakeCode Logo"}))),i.createElement("div",{className:"spacer"}),i.createElement("div",{className:"header-right"},a&&i.createElement("div",{className:"header-button",role:"button",onClick:this.onSaveClicked},lf("SAVE TO MY PROJECTS")),(null===r||void 0===r?void 0:r.length)>0&&i.createElement(Z,{icon:"setting",className:"header-settings",items:r}),i.createElement("div",{className:"header-org-logo"},i.createElement("img",{src:x("assets/microsoft.png"),alt:"Microsoft Logo"}))))}}]),a}(i.Component);var he={dispatchSaveAndCloseActivity:$,dispatchShowResetUserModal:function(){return{type:"SHOW_RESET_USER_MODAL"}}},fe=Object(l.b)((function(e,t){var a,r,n,i;if(!e)return{};(null===(a=e.editorView)||void 0===a?void 0:a.currentHeaderId)&&L(e.user,e.editorView.currentMapId,e.editorView.currentActivityId)&&(i=e.editorView.currentHeaderId);var c=!!e.editorView;return{activityOpen:c,currentMapId:c&&(null===(r=e.editorView)||void 0===r?void 0:r.currentMapId),currentActivityId:c&&(null===(n=e.editorView)||void 0===n?void 0:n.currentActivityId),showReportAbuse:"unknown"===e.pageSourceStatus,completedHeaderId:i}}),he)(ve),be=function(e){Object(K.a)(a,e);var t=Object(z.a)(a);function a(){return Object(F.a)(this,a),t.apply(this,arguments)}return Object(Y.a)(a,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.description,r=e.icon,n=e.infoUrl;return i.createElement("div",{className:"banner"},i.createElement("div",{className:"banner-card"},i.createElement("i",{className:"icon ".concat(r)}),i.createElement("div",{className:"banner-text"},i.createElement("div",{className:"banner-title"},i.createElement("span",null,t),n&&i.createElement("a",{className:"banner-info",href:n,target:"_blank",rel:"noopener noreferrer",role:"button"},i.createElement("i",{className:"icon info circle"}))),i.createElement("div",{className:"banner-description"},a))))}}]),a}(i.Component);var ye=Object(l.b)((function(e,t){return{title:e.title,description:e.description,infoUrl:e.infoUrl}}))(be),ge=(a(40),function(e){Object(K.a)(a,e);var t=Object(z.a)(a);function a(){var e;Object(F.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleModalClick=function(e){e.stopPropagation(),e.preventDefault()},e.handleCloseClick=function(){e.props.onClose&&e.props.onClose(),e.setState({visible:!1})},e}return Object(Y.a)(a,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.actions;return i.createElement("div",{className:"modal-overlay",onClick:this.handleCloseClick,role:"region"},i.createElement("div",{className:"modal",onClick:this.handleModalClick,role:"dialog"},i.createElement("div",{className:"modal-header"},i.createElement("div",{className:"modal-title"},t),i.createElement("div",{className:"spacer"}),i.createElement("div",{className:"modal-close-icon",onClick:this.handleCloseClick,role:"button"},i.createElement("i",{className:"icon close"}))),i.createElement("div",{className:"modal-body"},this.props.children),a&&a.length>0&&i.createElement("div",{className:"modal-actions"},a.map((function(e,t){return i.createElement("div",{key:t,className:"modal-button ".concat(e.className),onClick:e.onClick,role:"button"},e.label)})))))}}]),a}(i.Component)),ke=function(e){Object(K.a)(a,e);var t=Object(z.a)(a);function a(){var e;Object(F.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleOnClose=function(){e.props.dispatchHideModal()},e}return Object(Y.a)(a,[{key:"render",value:function(){var e=this.props,t=e.activity,a=e.type,r=e.completionType;switch(a){case"completion":return t||"map"===r?this.renderCompletionModal():i.createElement("div",null);case"restart-warning":return t?this.renderRestartWarning():i.createElement("div",null);case"report-abuse":return this.renderReportAbuse();case"reset":return this.renderResetWarning();default:return i.createElement("div",null)}}},{key:"renderCompletionModal",value:function(){var e=this.props,t=e.type,a=e.displayName,r=e.completionType,n=e.actions;if(!t)return i.createElement("div",null);var c="activity"===r?lf("Activity Complete!"):lf("Path Complete!"),s=lf("Good work! You've completed {0}. Collect your certificate and keep going!","{0}").split("{0}");return i.createElement("div",{className:"confetti-container"},i.createElement(ge,{title:c,actions:n,onClose:this.handleOnClose},s[0],i.createElement("strong",null,a),s[1]),Array(100).fill(0).map((function(e,t){var a={animationDelay:"".concat(t%100*.1,"s"),left:"".concat(1*Math.floor(100*Math.random()),"%")};return i.createElement("div",{key:t,style:a,className:"confetti ".concat(Math.random()>.5?"reverse":""," color-").concat(Math.floor(9*Math.random()))})})))}},{key:"renderRestartWarning",value:function(){var e=this.props,t=e.mapId,a=e.activity,r=e.dispatchRestartActivity,n=lf("Restart Activity?"),c=lf("Are you sure you want to restart {0}? You won't lose your path progress but the code have written for this activity will be deleted.","{0}").split("{0}"),s=[{label:lf("CANCEL"),onClick:this.handleOnClose},{label:lf("RESTART"),onClick:function(){N("skillmap.activity.restart",{path:t,activity:a.activityId}),r(t,a.activityId)}}];return i.createElement(ge,{title:n,actions:s,onClose:this.handleOnClose},c[0],i.createElement("strong",null,a.displayName),c[1])}},{key:"renderResetWarning",value:function(){var e=this.props,t=e.dispatchResetUser,a=e.dispatchHideModal,r=lf("Reset All Activities?"),n=lf("Are you sure you want to reset? This will permanently erase all progress and delete the project created for each tutorial. This action cannot be undone."),c=[{label:lf("CANCEL"),onClick:this.handleOnClose},{label:lf("RESET"),onClick:function(){N("skillmap.reset"),t(),a()}}];return i.createElement(ge,{title:r,actions:c,onClose:this.handleOnClose},n)}},{key:"renderReportAbuse",value:function(){var e=this.props,t=e.pageSourceUrl,a=e.dispatchHideModal,r=[{label:"REPORT",onClick:function(){N("skillmap.reportabuse"),function(e,t){I.apply(this,arguments)}(t||"",{text:document.querySelector(".report-abuse-text").value}),a()}}];return i.createElement(ge,{title:"Report Abuse",actions:r,onClose:this.handleOnClose},i.createElement("textarea",{className:"report-abuse-text",placeholder:"Describe the content and explain why you are reporting it for abuse. Provide as much detail as possible!"}))}}]),a}(i.Component);var Ee={dispatchHideModal:X,dispatchRestartActivity:function(e,t){return{type:"RESTART_ACTIVITY",mapId:e,activityId:t}},dispatchOpenActivity:J,dispatchResetUser:function(){return{type:"RESET_USER"}}},Oe=Object(l.b)((function(e,t){if(!e)return{};var a,r,n,i=e.pageSourceUrl,c=e.modal||{},s=c.currentMapId,o=c.currentActivityId,l=c.type,d=[];if(s&&"restart-warning"!==l){var u=e.maps[s];if(o){var p,m,v=u.activities[o];n="activity",r=v.displayName,a=null===(p=v.next)||void 0===p||null===(m=p[0])||void 0===m?void 0:m.activityId,d.push({label:lf("NEXT"),onClick:function(){N("skillmap.activity.next",{path:s,activity:o}),J(s,a||"")}})}else n="map",r=u.displayName,d.push({label:lf("CERTIFICATE"),onClick:function(){N("skillmap.certificate",{path:s}),window.open(u.completionUrl)}})}return{type:l,completionType:n,displayName:r,nextActivityId:a,pageSourceUrl:i,actions:d,mapId:s,activity:s&&o?e.maps[s].activities[o]:void 0}}),Ee)(ke);function Ie(e){var t=e.label;return i.createElement("span",null,t)}function Se(e){var t=e.item,a=e.itemTemplate,r=e.selected,n=e.className,c=e.onSelect,s=a||Ie;return i.createElement("div",{className:"carousel-item ".concat(r?"selected":""," ").concat(n||""),onClick:function(){c&&c(t.id)},role:"group"},i.createElement(s,t))}a(41);var Ce=function(e){Object(K.a)(a,e);var t=Object(z.a)(a);function a(e){var r;return Object(F.a)(this,a),(r=t.call(this,e)).scrollMargin=5,r.carouselRef=void 0,r.scrollTo=function(e){r.carouselRef.scrollTo(e,0)},r.handleLeftArrowClick=function(){r.carouselRef.scrollBy({left:-window.innerWidth/2})},r.handleRightArrowClick=function(){r.carouselRef.scrollBy({left:window.innerWidth/2})},r.handleScroll=function(){var e=r.carouselRef.scrollLeft;r.setState({showLeft:e>r.scrollMargin,showRight:r.carouselRef.scrollWidth-r.carouselRef.clientWidth-e>r.scrollMargin})},r.handleRef=function(e){r.carouselRef=e},r.state={showLeft:!1,showRight:!0},r}return Object(Y.a)(a,[{key:"componentDidMount",value:function(){this.handleScroll(),window.addEventListener("resize",this.handleScroll)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleScroll)}},{key:"render",value:function(){var e=this.props,t=e.title,a=e.items,r=e.selectedItem,n=e.itemTemplate,c=e.itemClassName,s=e.onItemSelect,o=e.prependChildren,l=e.appendChildren,d=e.titleIcon,u=e.titleDecoration,p=this.state,m=p.showLeft,v=p.showRight;return i.createElement("div",{className:"carousel"},t&&i.createElement("div",{className:"carousel-title"},d&&i.createElement("i",{className:"icon ".concat(d)}),i.createElement("span",null,t),u&&i.createElement("span",{className:"carousel-subtitle"},u)),m&&i.createElement("div",{className:"carousel-arrow left",onClick:this.handleLeftArrowClick,role:"button"},i.createElement("i",{className:"icon chevron left"})),i.createElement("div",{className:"carousel-items"},i.createElement("div",{className:"carousel-items-inner",onScroll:this.handleScroll,ref:this.handleRef},o,a.map((function(e,t){return i.createElement(Se,{key:t,className:c,item:e,itemTemplate:n,selected:r===e.id,onSelect:s})})),l)),v&&i.createElement("div",{className:"carousel-arrow right",onClick:this.handleRightArrowClick,role:"button"},i.createElement("i",{className:"icon chevron right"})))}}]),a}(i.Component),we=(a(42),function(e){Object(K.a)(a,e);var t=Object(z.a)(a);function a(){var e;Object(F.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleActionButtonClick=function(){var t=e.props,a=t.status,r=t.mapId,n=t.id,i=t.dispatchOpenActivity;switch(a){case"locked":break;case"completed":case"inprogress":case"notstarted":case"restarted":default:return N("skillmap.activity.open",{path:r,activity:n,status:a||""}),i(r,n)}},e.handleRestartButtonClick=function(){var t=e.props,a=t.mapId,r=t.id;(0,t.dispatchShowRestartActivityWarning)(a,r)},e}return Object(Y.a)(a,[{key:"getSkillCardActionText",value:function(){switch(this.props.status){case"locked":return lf("LOCKED");case"completed":return lf("VIEW CODE");case"inprogress":case"restarted":return lf("CONTINUE");case"notstarted":default:return lf("START")}}},{key:"isCompleted",value:function(e){return"completed"===e||"restarted"===e}},{key:"render",value:function(){var e=this.props,t=e.label,a=e.description,r=e.imageUrl,n=e.tags,c=e.status,s=e.currentStep,o=e.maxSteps,l=this.isCompleted(c||"notstarted");return i.createElement("div",{className:"skill-card-container"},i.createElement("div",{className:"skill-card ".concat(c||"")},i.createElement("div",{className:"skill-card-display"},i.createElement("div",{className:"skill-card-image"},r?i.createElement("img",{src:r,alt:lf("Preview of activity content")}):i.createElement("i",{className:"icon ".concat("locked"!==c?"game":"")})),i.createElement("div",{className:"skill-card-label"},i.createElement("div",{className:"skill-card-title"},l&&i.createElement("i",{className:"icon check circle"}),"inprogress"===c&&o&&i.createElement("span",{className:"circular-label"},"".concat(s,"/").concat(o)),i.createElement("span",null,t)),i.createElement("div",{className:"skill-card-tags"},null===n||void 0===n?void 0:n.map((function(e,t){return i.createElement("div",{key:t},e)})))),"locked"===c&&i.createElement("div",{className:"skill-card-overlay"},i.createElement("i",{className:"icon lock"}))),i.createElement("div",{className:"skill-card-info"},i.createElement("div",{className:"skill-card-title"},t),i.createElement("div",{className:"skill-card-description"},a),i.createElement("div",{className:"spacer"}),i.createElement("div",{className:"skill-card-action"},l&&i.createElement("div",{className:"skill-card-button-icon",role:"button",onClick:this.handleRestartButtonClick},i.createElement("i",{className:"xicon redo"})),i.createElement("div",{className:"skill-card-button",role:"button",onClick:this.handleActionButtonClick},this.getSkillCardActionText())))))}}]),a}(i.Component));var je={dispatchOpenActivity:J,dispatchShowRestartActivityWarning:function(e,t){return{type:"SHOW_RESTART_ACTIVITY_MODAL",mapId:e,activityId:t}}},Ae=Object(l.b)((function(e,t){var a,r,n,i=null===(a=e.maps)||void 0===a?void 0:a[t.mapId],c=e.user&&i&&function(e,t,a){return t.root.activityId===a||function r(n){if(L(e,t.mapId,n.activityId)){if(n.next.some((function(e){return e.activityId===a})))return!0;var i,c=Object(R.a)(n.next);try{for(c.s();!(i=c.n()).done;){var s=i.value;if(r(s))return!0}}catch(o){c.e(o)}finally{c.f()}}return!1}(t.root)}(e.user,i,t.id)?"notstarted":"locked";if(e.user)if(i&&e.pageSourceUrl&&!M(e.user,i,e.pageSourceUrl))c="locked";else{var s=P(e.user,t.mapId,t.id);s&&(s.isCompleted?c=s.currentStep&&s.maxSteps&&s.currentStep<s.maxSteps?"restarted":"completed":s.headerId&&(c="inprogress",r=null===s||void 0===s?void 0:s.currentStep,n=null===s||void 0===s?void 0:s.maxSteps))}return{status:c,currentStep:r,maxSteps:n}}),je)(we),xe=function(e){Object(K.a)(a,e);var t=Object(z.a)(a);function a(e){var r;return Object(F.a)(this,a),(r=t.call(this,e)).carouselRef=void 0,r.items=void 0,r.onItemSelect=function(e){var t=r.props,a=t.map,n=t.dispatchChangeSelectedItem;e!==r.props.selectedItem?(N("skillmap.carousel.item.select",{path:a.mapId,activity:e}),n(e)):(N("skillmap.carousel.item.deselect",{path:a.mapId,activity:e}),n(void 0))},r.handleEndCardClick=function(){var e=r.props,t=e.map,a=e.dispatchShowCompletionModal;N("skillmap.carousel.endcard.click",{path:t.mapId}),a(t.mapId)},r.handleEndCardTransition=function(){var e=r.props,t=e.map,a=e.dispatchShowCompletionModal;N("skillmap.carousel.endcard.auto",{path:t.mapId}),a(t.mapId)},r.handleCarouselRef=function(e){r.carouselRef=e},r.items=r.getItems(e.map.mapId,e.map.root),r}return Object(Y.a)(a,[{key:"getItems",value:function(e,t){for(var a=[],r=t;r;)a.push({id:r.activityId,label:r.displayName,url:r.url,imageUrl:r.imageUrl,mapId:e,description:r.description,tags:r.tags}),r=r.next[0];return a}},{key:"getEndCard",value:function(){return i.createElement("div",{className:"end-card ".concat("completed"===this.props.completionState?"spin":""),key:"end"},i.createElement("div",{className:"end-card-icon",onClick:this.handleEndCardClick,role:"button"},i.createElement("i",{className:"icon trophy",onTransitionEnd:this.handleEndCardTransition})))}},{key:"renderRequirements",value:function(){var e=this;if(this.props.pageSourceUrl){var t=this.props.map.prerequisites,a=this.props.user.completedTags,r=t.map((function(t){if("tag"===t.type){var r=t.numberCompleted;if(a[e.props.pageSourceUrl]&&a[e.props.pageSourceUrl][t.tag]&&(r=Math.max(r-a[e.props.pageSourceUrl][t.tag],0)),r)return i.createElement("span",{key:"tag_"+t.tag},r," ",i.createElement("span",{className:"carousel-subtitle-tag"},t.tag))}return null})).filter((function(e){return!!e})),n=this.props.requiredMaps.map((function(e){return i.createElement("span",{key:"map_"+e.mapId,className:"carousel-subtitle-map"},e.displayName)}));return r.length||n.length?n.length?r.length?Ne(lf("Complete {0} tutorial(s) and the {1} map(s) to unlock!","{0}","{1}"),[Te(r),Te(n)]):Ne(lf("Complete the {0} map(s) to unlock!","{0}"),[Te(n)]):Ne(lf("Complete {0} tutorial(s) to unlock!","{0}"),[Te(r)]):void 0}}},{key:"componentDidUpdate",value:function(e){"transitioning"===e.completionState&&(this.carouselRef.scrollTo(1e4),setTimeout((function(){return e.dispatchSetSkillMapCompleted(e.map.mapId)}),400))}},{key:"render",value:function(){var e=this.props,t=e.map,a=e.user,r=e.selectedItem,n=U(a,t)?[this.getEndCard()]:[],c=this.renderRequirements();return i.createElement(Ce,{title:t.displayName,items:this.items,itemTemplate:Ae,itemClassName:"linked",onItemSelect:this.onItemSelect,selectedItem:r,appendChildren:n,titleIcon:c&&"lock",titleDecoration:c,ref:this.handleCarouselRef})}}]),a}(i.Component);function Te(e){return e.length<=1?e[0]:2===e.length?i.createElement("span",null,e[0]," and ",e[1]):i.createElement("span",null,e.slice(0,e.length-1).map((function(e){return i.createElement("span",null,e,", ")}))," and ",e[e.length-1])}function Ne(e,t){for(var a=[],r=e,n=0,c=0;c<t.length;c++){var s=r.split("{"+c+"}");a.push(i.createElement("span",{key:n++},s[0])),a.push(i.createElement("span",{key:n++},t[c])),r=r.substr(s[0].length+3)}return a.push(i.createElement("span",{key:n++},r)),i.createElement("span",null,a)}var Re={dispatchChangeSelectedItem:function(e){return{type:"CHANGE_SELECTED_ITEM",id:e}},dispatchShowCompletionModal:function(e,t){return{type:"SHOW_COMPLETION_MODAL",mapId:e,activityId:t}},dispatchSetSkillMapCompleted:function(e){return{type:"SET_SKILL_MAP_COMPLETED",mapId:e}}},Ue=Object(l.b)((function(e,t){var a,r,n,i,c,s;if(!e)return{};var o=t.map,l=[];return(null===(a=o.prerequisites)||void 0===a?void 0:a.length)&&e.pageSourceUrl&&(l=o.prerequisites.filter((function(t){return"map"===t.type&&!M(e.user,e.maps[t.mapId],e.pageSourceUrl)})).map((function(t){return e.maps[t.mapId]}))),{user:e.user,requiredMaps:l,pageSourceUrl:e.pageSourceUrl,completionState:null===(r=e.user)||void 0===r||null===(n=r.mapProgress)||void 0===n||null===(i=n[o.mapId])||void 0===i?void 0:i.completionState,selectedItem:e.selectedItem&&(null===(c=t.map)||void 0===c||null===(s=c.activities)||void 0===s?void 0:s[e.selectedItem])?e.selectedItem:void 0}}),Re)(xe);function Le(e){for(var t,a,r=function(e){var t,a=e.split("\n"),r=[],n=null,i=null,c=null,s=Object(R.a)(a);try{for(s.s();!(t=s.n()).done;){var o=t.value;if(o.trim()){if(o.startsWith("#")){var l=/^(#+)\s*(.+)$/.exec(o);if(l){u(),n={headerKind:1===l[1].length?"single":2===l[1].length?"double":"triple",header:l[2],attributes:{}},i=null,c=null;continue}}if(n){var d=/^[*-]\s+(?:([^:]+):)?(.*)$/.exec(o);d&&(d[1]?(i&&c&&(n.attributes[i]=c.trim()),i=d[1].toLowerCase(),c=d[2]):i&&(c+=d[2]))}}else c&&(c+="\n")}}catch(p){s.e(p)}finally{s.f()}return u(),r;function u(){n&&(i&&c&&(n.attributes[i]=c.trim()),r.push(n))}}(e),n=[],i=-1,c=0;c<r.length;c++)"single"===r[c].headerKind?t={title:(a=r[c]).attributes.name||a.header,description:a.attributes.description,infoUrl:a.attributes.infourl}:"double"===r[c].headerKind&&(i>=0&&n.push(Me(r[i],r.slice(i+1,c))),i=c);return(i>0||0===n.length)&&n.push(Me(r[i],r.slice(i+1,r.length))),{maps:n,metadata:t}}function Me(e,t){var a=function(e){var t={mapId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,completionUrl:e.attributes.completionurl,prerequisites:[],activities:{}};if(e.attributes.required){var a,r=e.attributes.required.split(","),n=Object(R.a)(r);try{for(n.s();!(a=n.n()).done;){var i=a.value,c=/^\s*(?:(\d+) +)?(.+)$/.exec(i);c[1]?t.prerequisites.push({type:"tag",tag:c[2].trim(),numberCompleted:parseInt(c[1])}):t.prerequisites.push({type:"map",mapId:c[2].trim()})}}catch(s){n.e(s)}finally{n.f()}}return t}(e),r=t.map(_e);a.root=r[0];var n,i=Object(R.a)(r);try{for(i.s();!(n=i.n()).done;){var c=n.value;a.activities[c.activityId]&&De("Duplicate activity id '".concat(c.activityId,"' in map '").concat(a.mapId,"'")),a.activities[c.activityId]=c}}catch(y){i.e(y)}finally{i.f()}var s,o=Object(R.a)(r);try{for(o.s();!(s=o.n()).done;){var l,d=s.value,u=Object(R.a)(d.nextIds);try{for(u.s();!(l=u.n()).done;){var m=l.value;a.activities[m]||De("Unknown activity id '".concat(m,"' in map '").concat(a.mapId,"'")),d.next.push(a.activities[m])}}catch(y){u.e(y)}finally{u.f()}}}catch(y){o.e(y)}finally{o.f()}var v={};!function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r[t.activityId]&&De("Loop in map '".concat(a.mapId,"' detected"));r[t.activityId]=!0,v[t.activityId]=!0,t.next.length>1&&De("Branching currently not supported");var n,i=Object(R.a)(t.next);try{for(i.s();!(n=i.n()).done;){var c=n.value;e(c,Object(p.a)({},r))}}catch(y){i.e(y)}finally{i.f()}}(a.root);var h,f=Object(R.a)(r);try{for(f.s();!(h=f.n()).done;){var b=h.value;v[b.activityId]||console.warn("Unreachable activity detected '".concat(b.activityId,"' in map '").concat(a.mapId,"'"))}}catch(y){f.e(y)}finally{f.f()}return a}function _e(e){var t={activityId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,url:e.attributes.url,imageUrl:e.attributes.imageurl,tags:Pe(e.attributes.tags),next:[],nextIds:Pe(e.attributes.next)};if(e.attributes.type){var a=e.attributes.type.toLowerCase();switch(a){case"tutorial":t.type=a}}if(e.attributes.editor){var r=e.attributes.editor.toLowerCase();switch(r){case"py":case"blocks":case"js":t.editor=r;break;default:t.editor="blocks"}}return t.url||De("Activity '".concat(t.activityId,"' is missing attribute 'url'")),t.type||De("Activity '".concat(t.activityId,"' is missing attribute 'type'")),t}function Pe(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return[];var a=e.split(",").map((function(e){return e.trim().toLowerCase()})).filter((function(e){return!!e}));if(!t){var r={};return a.forEach((function(e){return r[e]=e})),Object.keys(r)}return a}function De(e){throw e}a(43),a(44);window.Promise=Q;var Ve=function(e){Object(K.a)(a,e);var t=Object(z.a)(a);function a(e){var r;return Object(F.a)(this,a),(r=t.call(this,e)).queryFlags={},r.unsubscribeChangeListener=void 0,r.loadedUser=void 0,r.handleHashChange=function(){var e=Object(h.a)(v.a.mark((function e(t){var a,n,i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pxt.targetConfigAsync();case 2:n=e.sent,i=b(window.location.hash||(null===(a=n.skillMap)||void 0===a?void 0:a.defaultPath)),r.fetchAndParseSkillMaps(i.cmd,i.arg),t.stopPropagation(),t.preventDefault();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.handleError=function(e){var t=e||lf("Oops! Couldn't load content, please check the URL and markdown file.");console.error(t),r.setState({error:t})},r.onStoreChange=Object(h.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=G.getState(),(a=t.user)===r.loadedUser||r.loadedUser&&a.id!==r.loadedUser.id){e.next=5;break}return e.next=4,se(a);case 4:r.loadedUser=a;case 5:case"end":return e.stop()}}),e)}))),r.state={},window.addEventListener("hashchange",r.handleHashChange),r}return Object(Y.a)(a,[{key:"initLocalizationAsync",value:function(){var e=Object(h.a)(v.a.mark((function e(){var t,a,r,n,i,c,s,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=pxt.appTarget.appTheme,a=window.location.href,r=!1,n=void 0,/[&?]translate=1/.test(a)&&!pxt.BrowserUtils.isIE()?(console.log("translation mode"),n=ts.pxtc.Util.TRANSLATION_LOCALE):((i=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(window.location.href))&&window.location.hash.indexOf(i[0])>=0&&pxt.BrowserUtils.changeHash(window.location.hash.replace(i[0],"")),n=i?i[3]:pxt.BrowserUtils.getCookieLang()||t.defaultLocale||navigator.userLanguage||navigator.language,r=!!i&&!!i[2]),"",c=pxt.appTarget.id,s=pxt.appTarget.versions.pxtCrowdinBranch,o=pxt.appTarget.versions.targetCrowdinBranch,e.next=11,He(c,"",n,s,o,!0,r);case 11:pxt.Util.isLocaleEnabled(n)&&pxt.BrowserUtils.setCookieLang(n);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchAndParseSkillMaps",value:function(){var e=Object(h.a)(v.a.mark((function e(t,a){var n,i,c,s,o,l,d,u,p,m,h,f,b=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t,a);case 2:if(n=e.sent,i=null===n||void 0===n?void 0:n.text,c=null===n||void 0===n?void 0:n.identifier,s=null===n||void 0===n?void 0:n.status,i&&c&&s)try{"banned"===s?this.handleError(lf("This GitHub repository has been banned.")):(T(c),this.props.dispatchSetPageSourceUrl(c,s)),l=Le(i),d=l.maps,u=l.metadata,(null===d||void 0===d?void 0:d.length)>0&&(o=d,this.props.dispatchClearSkillMaps(),d.forEach((function(e){b.props.dispatchAddSkillMap(e)}))),u&&(p=u.title,m=u.description,h=u.infoUrl,r=p,this.props.dispatchSetPageTitle(p),m&&this.props.dispatchSetPageDescription(m),h&&this.props.dispatchSetPageInfoUrl(h)),this.setState({error:void 0})}catch(v){this.handleError()}else this.setState({error:lf("No content loaded.")});return e.next=9,ie();case 9:(f=e.sent)||(f={id:j(),completedTags:{},mapProgress:{}}),c&&!f.completedTags[c]&&(f.completedTags[c]={}),this.applyQueryFlags(f,o),this.loadedUser=f,this.props.dispatchSetUser(f);case 15:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(h.a)(v.a.mark((function e(){var t,a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.unsubscribeChangeListener=G.subscribe(this.onStoreChange),this.queryFlags=y(),e.next=4,pxt.targetConfigAsync();case 4:return a=e.sent,r=b(window.location.hash||(null===(t=a.skillMap)||void 0===t?void 0:t.defaultPath)),e.next=8,this.initLocalizationAsync();case 8:this.fetchAndParseSkillMaps(r.cmd,r.arg);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.handleHashChange),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}},{key:"render",value:function(){var e=this.props,t=e.skillMaps,a=e.activityOpen,r=this.state.error,n=Object.keys(t).map((function(e){return t[e]}));return c.a.createElement("div",{className:"app-container ".concat(pxt.appTarget.id)},c.a.createElement(fe,null),a?c.a.createElement(me,null):c.a.createElement("div",null,c.a.createElement(ye,{icon:"map"}),c.a.createElement("div",{className:"skill-map-container"},r?c.a.createElement("div",{className:"skill-map-error"},r):null===n||void 0===n?void 0:n.map((function(e,t){return c.a.createElement(Ue,{map:e,key:t})})))),c.a.createElement(Oe,null))}},{key:"applyQueryFlags",value:function(e,t,a){if("true"===this.queryFlags.debugNewUser&&(e.isDebug=!0,e.mapProgress={},e.completedTags={}),"true"===this.queryFlags.debugCompleted&&(e.isDebug=!0,t)){var r,n=Object(R.a)(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;e.mapProgress[i.mapId]={completionState:"completed",mapId:i.mapId,activityState:{}};for(var c=0,s=Object.keys(i.activities);c<s.length;c++){var o,l=s[c],d=i.activities[l];if(e.mapProgress[i.mapId].activityState[d.activityId]?e.mapProgress[i.mapId].activityState[d.activityId].isCompleted=!0:e.mapProgress[i.mapId].activityState[d.activityId]={activityId:d.activityId,isCompleted:!0},(null===(o=d.tags)||void 0===o?void 0:o.length)&&a){var u,p=Object(R.a)(d.tags);try{for(p.s();!(u=p.n()).done;){var m=u.value;e.completedTags[a][m]||(e.completedTags[a][m]=0),e.completedTags[a][m]++}}catch(v){p.e(v)}finally{p.f()}}}}}catch(v){n.e(v)}finally{n.f()}}}}]),a}(c.a.Component);function He(e,t,a,r,n,i,c){return We.apply(this,arguments)}function We(){return(We=Object(h.a)(v.a.mark((function e(t,a,r,n,i,c,s){var o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("en-US"===(r=pxt.Util.normalizeLanguageCode(r)[0])&&(r="en"),r!==pxt.Util.userLanguage()&&(pxt.Util.isLocaleEnabled(r)||s)){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,pxt.Util.downloadTranslationsAsync(t,a,r,n,i,!!c,ts.pxtc.Util.TranslationsKind.SkillMap);case 6:o=e.sent,pxt.Util.setUserLanguage(r),o&&(pxt.Util.setLocalizedStrings(o),c&&(pxt.Util.localizeLive=!0));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Be={dispatchAddSkillMap:function(e){return{type:"ADD_SKILL_MAP",map:e}},dispatchClearSkillMaps:function(){return{type:"CLEAR_SKILL_MAPS"}},dispatchSetPageTitle:function(e){return{type:"SET_PAGE_TITLE",title:e}},dispatchSetPageDescription:function(e){return{type:"SET_PAGE_DESCRIPTION",description:e}},dispatchSetPageInfoUrl:function(e){return{type:"SET_PAGE_INFO_URL",infoUrl:e}},dispatchSetUser:function(e){return{type:"SET_USER",user:e}},dispatchSetPageSourceUrl:function(e,t){return{type:"SET_PAGE_SOURCE_URL",url:e,status:t}}},qe=Object(l.b)((function(e,t){return e?{skillMaps:e.maps,activityOpen:!!e.editorView}:{}}),Be)(Ve),Ge=window.pxtTargetBundle;Ge.bundledpkgs={},pxt.setAppTarget(Ge),pxt.Cloud.apiRoot="https://www.makecode.com/api/",o.a.render(c.a.createElement(l.a,{store:G},c.a.createElement(qe,null)),document.getElementById("root"))}},[[24,1,2]]]);